$(document).ready(function(){$(".del_attach").bind("click",onDeleteAttachment);$(".btnDelete").bind("click",onDeleteBlock);$(".btnDown").bind("click",onBlockDown);$(".btnUp").bind("click",onBlockUp);$("#bDeletePage").bind("click",onDeletePage);$("a.btnIEdit").bind("click",onEditImage);$("#upload-btn").bind("click",onUpload)});function onBlockDown(a){blockId=getBlockIdFromClass(this.className);ajaxMoveBlock(blockId,"down");blockToMove=$("#b"+blockId);blockToSwapWith=blockToMove.next();blockToMove.fadeOut("normal",function(){blockToMove.insertAfter(blockToSwapWith);blockToMove.fadeIn("normal");showHideUpDownButtons(blockToMove,blockToSwapWith)});return false}function onBlockUp(a){blockId=getBlockIdFromClass(this.className);ajaxMoveBlock(blockId,"up");blockToMove=$("#b"+blockId);blockToSwapWith=blockToMove.prev();blockToMove.fadeOut("normal",function(){blockToMove.insertBefore(blockToSwapWith);blockToMove.fadeIn("normal");showHideUpDownButtons(blockToSwapWith,blockToMove)});return false}function onDeleteAttachment(){$.prompt("Do you want to delete this asset?",{buttons:{Yes:this.href,No:false},callback:onAnswer});return false}function onDeleteBlock(){$.prompt("Do you want to delete this block?",{buttons:{Yes:this.href,No:false},callback:onAnswer});return false}function onDeletePage(){$.prompt("Do you want to delete this page?",{buttons:{Yes:this.href,No:false},callback:onAnswer});return false}function onEditImage(a){if($("#collection-scroller").length==0){qString=this.href;qBits=/imageedit=(\d+)/.exec(qString);imageId=qBits[1];qBits=/blockedit=(\d+)/.exec(qString);blockId=qBits[1];loadCollectionScroller(blockId,imageId)}window.location=String(window.location).replace(/\#.*$/,"")+"#wrap-main";return false}function onSaveImage(a){qString=this.href;qBits=/blockedit=(\d+)/.exec(qString);blockId=qBits[1];qBits=/c=(\d+)/.exec(qString);pictureId=qBits[1];qBits=/imageedit=(\d+)/.exec(qString);picturePlace=qBits[1];$.post("/system/ajax/block.action.savepicture.php",{block_id:blockId,picture_place:picturePlace,picture_id:pictureId});selector="div#b"+blockId+" a.p"+picturePlace+" img.edit";console.info(selector);console.info($(selector));image=$(selector);imageHolder=image.parent();console.info(imageHolder);image.remove();imageHolder.load("/system/ajax/block.action.showpicture.php",{block_id:blockId,picture_place:picturePlace,picture_id:pictureId});$("div#scroll").remove();return false}function onAnswer(b,a){if(b!=false){window.location=b}}function onUpload(){$("#loaderImg").removeClass("hideme");return true}function ajaxMoveBlock(a,b){pageId=getPageIdFromClass($("#wrap-main").attr("class"));$.post("/system/ajax/block.action.move.php",{page_id:pageId,block_id:a,dir:b})}function getBlockIdFromClass(a){classBits=/bl(\d+)/.exec(a);return(classBits!=null)?classBits[1]:0}function getPageIdFromClass(a){console.info(a);classBits=/p(\d+)/.exec(a);return(classBits!=null)?classBits[1]:0}function loadCollectionScroller(a,b){$("#loader").css("display","block");$("div.fix").after('<div id="scroll">');$("div#scroll").load("/system/ajax/html/assetscroller.php",{blockId:a,pictureId:b},function(){setupScrollingCollection();$("div#scroll ul.items a").bind("click",onSaveImage);$("#loader").css("display","none")})}function showHideUpDownButtons(a,b){if(a.next().length==0){$(".btnDown",a).addClass("hidden");$(".btnDown",b).removeClass("hidden")}else{if(b.prev().length==0){$(".btnUp",b).addClass("hidden");$(".btnUp",a).removeClass("hidden")}}};